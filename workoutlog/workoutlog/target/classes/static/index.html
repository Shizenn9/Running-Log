<!DOCTYPE html>
<html>
<head>
  <title>Workout Log</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>üèÉ Workout Log</h1>

    <div class="summary">
      <p>Total Distance: <span id="totalDistance">0</span> km</p>
      <div class="progress-bar">
        <div id="progress" style="width: 0%"></div>
      </div>
    </div>

    <form id="workoutForm">
      <input type="text" id="date" placeholder="Date (YYYY-MM-DD)" required />
      <input type="number" id="distance" placeholder="Distance (km)" required />
      <input type="text" id="pace" placeholder="Pace (e.g. 5:42)" required />
      <button type="submit">Add Workout</button>
    </form>

    <h2>Workouts</h2>
    <ul id="workoutList"></ul>
  </div>

  <script>
    const list = document.getElementById("workoutList");
    const form = document.getElementById("workoutForm");
    const date = document.getElementById("date");
    const distance = document.getElementById("distance");
    const pace = document.getElementById("pace");
    const totalDistanceEl = document.getElementById("totalDistance");
    const progressEl = document.getElementById("progress");

    function loadWorkouts() {
      fetch("/workouts")
        .then(res => res.json())
        .then(data => {
          list.innerHTML = "";
          let totalDistance = 0;

          data.forEach(w => {
            const li = document.createElement("li");

            const text = document.createElement("span");
            text.textContent = `${w.date} ‚Äî ${w.distance} km @ ${w.pace}`;

            const editBtn = document.createElement("button");
            editBtn.textContent = "‚úèÔ∏è";
            editBtn.classList.add("delete-btn");

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "‚ùå";
            deleteBtn.classList.add("delete-btn");

            editBtn.onclick = () => {
            li.innerHTML = "";

            const dateInput = document.createElement("input");
            dateInput.value = w.date;

            const distInput = document.createElement("input");
            distInput.type = "number";
            distInput.value = w.distance;

            const paceInput = document.createElement("input");
            paceInput.value = w.pace;
            const saveBtn = document.createElement("button");
            saveBtn.textContent = "üíæ";
            saveBtn.classList.add("delete-btn");

            saveBtn.onclick = () => {
              fetch(`/workouts/${w.id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  date: dateInput.value,
                  distance: distInput.value,
                  pace: paceInput.value
                })
              }).then(() => loadWorkouts());
            };
          li.append(dateInput, distInput, paceInput, saveBtn);
  };

            deleteBtn.onclick = () => {
              if (confirm("Delete this workout?")) {
                    fetch(`/workouts/${w.id}`, { method: "DELETE" })
                        .then(() => loadWorkouts());
                }
            };
              li.append(text, editBtn, deleteBtn);
              list.appendChild(li);
              totalDistance += parseFloat(w.distance);});


          totalDistanceEl.textContent = totalDistance.toFixed(1);

          // Update progress bar (assuming goal = 50 km)
          const progressPercent = Math.min((totalDistance / 50) * 100, 100);
          progressEl.style.width = progressPercent + "%";
        });
    }

    form.addEventListener("submit", e => {
      e.preventDefault();

      fetch("/workouts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          date: date.value,
          distance: distance.value,
          pace: pace.value
        })
      }).then(() => {
        form.reset();
        loadWorkouts();
      });
    });

    loadWorkouts();
  </script>
</body>
</html>
